<div class="row justify-content-start backButton">
  <button (click)="navigateBack()" mat-raised-button color="secondary">
    <mat-icon><img src="../../../assets/Images/arrow_back-24px.svg" alt=""></mat-icon>
  </button>
</div>
<!-- update form -->
<div class="container mt-5">
  <div class="row align-items-center justify-content-center">
    <div class=" col-10 col-lg-5 ">
      <form #updateIssueForm="ngForm" (submit)="updateIssue(updateIssueForm)" *ngIf="editMode">
        <mat-form-field appearance="outline">
          <mat-label>Tag(s) (# prefix)</mat-label>
          <input [(ngModel)]='tagsString' name="Tags" matInput maxlength="100" form="repIssueForm"
            placeholder="ex: #StreetHole #CityCenter">
        </mat-form-field>
        <br>
        <mat-form-field appearance="outline">
          <mat-label>Description</mat-label>
          <textarea required #descriptionField="ngModel" name="description" [(ngModel)]='currentIssue.description'
            matInput maxlength="1000" form="updateIssueForm" placeholder="Write a small description..."></textarea>
          <mat-hint>{{description.length}}/1000</mat-hint>
        </mat-form-field>
        <p *ngIf="descriptionField.hasError('required') && descriptionField.touched" class="ErrorMessage">
          Description is required
        </p>
        <br>
        <mat-form-field *ngIf="auth.isAdminUser()" appearance="outline">
          <mat-label>State</mat-label>
          <mat-select name="typeSelector" [(ngModel)]="currentIssue.state">
            <mat-option value="">all</mat-option>
            <mat-option value="new">new</mat-option>
            <mat-option value="inProgress">inProgress</mat-option>
            <mat-option value="rejected">rejected</mat-option>
            <mat-option value="resolved">resolved</mat-option>
          </mat-select>
        </mat-form-field>
        <br>
        <div class="mb-5 row align-items-center justify-content-around">
          <button [disabled]="!this.mapMarkers.length || !updateIssueForm.valid" mat-raised-button color="primary"
            type="submit">Submit</button>
          <button (click)="editMode = false" mat-raised-button color="secondary">Cancel</button>
        </div>
      </form>
      <!-- issue details -->
      <div *ngIf="!editMode">
        <mat-card>
          <mat-card-title>
            <mat-chip-list #chipList>
              <mat-chip *ngFor="let tag of currentIssue.tags">{{tag}}</mat-chip>
            </mat-chip-list>
          </mat-card-title>
          <img [src]="currentIssue.imageUrl ? currentIssue.imageUrl : '../../../assets/Images/noImage.svg'"
            alt="{{currentIssue.imageUrl}}">
          <img *ngFor="let image of currentIssue.additionalImageUrls" [src]="image" alt="{{image}}">
          <div> created : {{currentIssue.createdAt | date:'mediumDate' }} </div>
          <br>
          <mat-card-content>{{currentIssue.description}}</mat-card-content>
          <mat-card-footer>
            <div [ngClass]="{'state-new' : currentIssue.state === 'new',
          'state-inprogress' : currentIssue.state === 'inProgress',
          'state-rejected' : currentIssue.state === 'rejected',
          'state-resolved' : currentIssue.state === 'resolved'}">
              {{currentIssue.state}}
            </div>
          </mat-card-footer>
        </mat-card>
        <button class="mt-5 mb-5" mat-raised-button color="primary" (click)="editMode = true">Edit</button>
      </div>
    </div>
    <div class="col-10 order-first order-lg-last mb-5 mb-lg-0 col-lg-6 offset-lg-1">
      <div (leafletClick)="updateMarker($event)" leaflet [leafletOptions]="mapOptions"
        (leafletMapReady)="onMapReady($event)" [leafletLayers]="mapMarkers" class="map" ngDefaultControl>
      </div>
    </div>
  </div>
</div>
<!-- comments -->
<app-comments-list  [comments]="comments" 
                    [display]="!editMode" 
                    (postCommentClicked)="postComment($event)">
</app-comments-list>